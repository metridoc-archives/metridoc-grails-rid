<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Metridoc Rid Plugin 0.1-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#technology"><strong>2</strong><span>Technology</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#databaseDesign"><strong>3</strong><span>Database Design (Bank-end)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#webUI"><strong>4</strong><span>Web User Interface (Front-end)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#unitTests"><strong>5</strong><span>Unit Tests</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#conclusion"><strong>6</strong><span>Insight and Conclusion</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#appendix"><strong>7</strong><span>Appendix -- Relationship among domain classes</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>Brief summary/description of the plugin.
</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Metridoc Rid Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Xiaofan Tong; Thomas Barker</p>
                            <p><strong>Version:</strong> 0.1-SNAPSHOT</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#technology"><strong>2</strong><span>Technology</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#databaseDesign"><strong>3</strong><span>Database Design (Bank-end)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#webUI"><strong>4</strong><span>Web User Interface (Front-end)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#Grails"><strong>4.1</strong><span>Grails</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#Bootstrap"><strong>4.2</strong><span>Bootstrap Front-end Framework</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#CSSMediaQuery"><strong>4.3</strong><span>CSS Media Query</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#Ajax"><strong>4.4</strong><span>AJAX</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#Excel"><strong>4.5</strong><span>Excel Importing/Exporting Function</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#Form"><strong>4.6</strong><span>Duplicated Form Submissions Handling</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#unitTests"><strong>5</strong><span>Unit Tests</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#conclusion"><strong>6</strong><span>Insight and Conclusion</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#appendix"><strong>7</strong><span>Appendix -- Relationship among domain classes</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The project I did during this semester’s independent study course is called Reference
Instruction Transactions Web Application. The purpose of this project is to build a web
application (actually a Grails Plugins into <a href="http://devmetridoc.library.upenn.edu/metridoc-reports/" target="blank">MetriDoc</a>)
named Reference Instruction Transactions to keep the records of users’ consultation
and instruction activities at the Van-Pelt Library.<p class="paragraph"/>At Van Pelt, users can apply for a consultation with specialists to help them finish their study goals.
For example, one student from CIS may want to find a specialist who is good at Computer Science to help
solve his or her issues regarding the master thesis. The user would like to talk by phone or meet the
specialist in person in the library three times totally and 30 minutes each time. All of these details
and requirement from users make up a Reference Instruction Transaction. All the data is recorded in a
MySQL database called Reference Instruction Database.<p class="paragraph"/>The development process is similar to the iterative and incremental development. In each period,
before start coding, we spent a decent amount of time discussing the technology we should use,
design of the database schema, and the work schedule. Several meetings were organized to discuss the
reliability and scalability of the program during the development process.<p class="paragraph"/>


<h1 id="technology">2 Technology</h1>
All in all, this is a web application, so it contains the back-end part and the front-end part.<p class="paragraph"/>At the back-end part, we use MySQL database. The integration tool we use is called
<a href="http://project.library.upenn.edu/jenkins/" target="blank">Jenkins</a>, and it is an open source continuous integration
tool written in Java, and it is free. The servlet container we use to actually run the application is
<a href="http://www.eclipse.org/jetty/" target="blank">Jetty</a>, which has very similar functionality to tomcat.
Jenkins builds the software and deploys it to the Jetty instance.<p class="paragraph"/>At the front-end part, we use <a href="http://www.grails.org/" target="blank">Grails</a> as the MVC development framework.
Grails is an open source web application framework which uses the Groovy programming language (which is in
turn based on the Java platform). Groovy is an object-oriented programming language for the Java platform.
It is a dynamic language and also supports functional programming, such as closure.<p class="paragraph"/>Besides, we use jQuery with the help of <a href="http://twitter.github.io/bootstrap/index.html" target="blank">Bootstrap</a>
(a kind of CSS style template implemented by Twitter) to implement a wonderful user interface.
In order to let user views web-pages friendlier in their mobile devices, we also use media query to
automatically and dynamically re-format web pages.<p class="paragraph"/>



<h1 id="databaseDesign">3 Database Design (Bank-end)</h1>
There are a total of nine tables related to Reference Instruction Database.
<ul class="star">
<li>"rid_transaction" is the most important table. It represents one consultation record, and contains fields such as user name, user question, event length, so on and so forth. This table has fields related to all of the following tables.</li>
<li>"rid_course_sponsor" records different kinds of course sponsors, such as SAS, SEAS, Wharton, etc.</li>
<li>"rid_department" records different kinds of departments, such as BURS, CAMB, CBE, etc.</li>
<li>"rid_school" records different kinds of schools, such as GSE, Vet, Nursing, etc.</li>
<li>"rid_rank" records different kinds of user ranks, such as Undergrad student, Grad student, PhD/PostDoc, etc.</li>
<li>"rid_service_provided" records different kinds of services provided, such as Course design, Research assistance, etc.</li>
<li>"rid_user_goal" records different kinds of course sponsor, such as Senior Thesis, Master Thesis, Independent Research, etc.</li>
<li>"rid_mode_of_consultation" records different modes of consultation, such as Email, Phone, In Person, etc.</li>
<li>"rid_library_unit" records different kinds of library units, such as WIC, HSL, CDM, etc. The above three tables are grouped by library units. That means different library unit has different service provided, user goal and different mode of consultation accordingly.</li>
</ul><p class="paragraph"/>The following ER model shows the details of each table and relationship among them.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/ERModel.png"></img><p class="paragraph"/><blockquote class="note">
Please note that the ‘version’ item with BIGINT type in each table stands for the version of the content in this
table, and is updated (added by one) each time when the content of this table is revised.
</blockquote>


<h1 id="webUI">4 Web User Interface (Front-end)</h1>
The web user interface is implemented using Grails.
We uses <a href="http://jquery.com/" target="blank">jQuery</a> and <a href="http://twitter.github.io/bootstrap/" target="blank">Twitter Bootstrap</a>
(a kind of CSS style template implemented by Twitter) to improve the visual effect.



<h2 id="Grails">4.1 Grails</h2>
In this project, we use Grails as the MVC development framework.
Grails is an Open Source, full stack, web application framework for the JVM.
It takes advantage of the Groovy programming language and convention over configuration to provide
a productive and stream-lined development experience.<p class="paragraph"/>Groovy is an object-oriented programming language for the Java platform.
It is a dynamic language with features similar to those of Python, Ruby, and Perl.
It can be used as a scripting language for the Java Platform, is dynamically compiled to
Java Virtual Machine (JVM) bytecode, and interoperates with other Java code and libraries.
Groovy uses a Java-like bracket syntax. Most Java code is also syntactically valid Groovy. Besides, it also supports functional programming, such as closure.<p class="paragraph"/>Grails gives a very clear structure of the web application.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/GrailsStructure.png"></img><p class="paragraph"/>From the above picture, you can see there are mainly there parts in a Grails application:
controllers, domain, and views. Remember that Grails is a MVC framework, so those three parts correspond to
Model, View and Controller, respectively.<p class="paragraph"/>Compared to the ER model above, you may find the relationship between domain classes
(the Model part of MVC) and database tables are intuitively clear.
So are the relationship among domain, controller, and view. For example, the domain class RidCourseSponsor
is stored in the table named “rid_course_sponsor”, and all web pages regard to it are in the folder named
“ridCourseSponsor”. The controller is named as “RidCourseSponsorController”.<p class="paragraph"/>Please refer to <a href="../guide/single.html#appendix" class="guide">this page</a> of this report for a relationship model among all these domain classes.



<h2 id="Bootstrap">4.2 Bootstrap Front-end Framework</h2>
In this project, I use <a href="http://twitter.github.io/bootstrap/" target="blank">Twitter Bootstrap</a> for the front-end framework
for faster and easier web development.
It is a free collection of tools for creating websites and web applications, and it has relatively incomplete
support for HTML5 and CSS 3, but it is compatible with all major browsers. Basic information of compatibility
of websites or applications is available for all devices and browsers. It contains HTML and CSS-based design
templates for typography, forms, buttons, charts, navigation and other interface components, as well as
optional JavaScript extensions.<p class="paragraph"/>The most important and powerful thing I use in the project is Modal, a kind of streamlined, but flexible,
sliding-in and fading-out dialog prompts with the minimum required functionality and smart defaults.
If a remote URL is provided, content will be loaded via jQuery's load method and injected into the modal body.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/Modal.png"></img>



<h2 id="CSSMediaQuery">4.3 CSS Media Query</h2>
HTML4 and CSS2 currently support media-dependent style sheets tailored for different media types.
For example, a document may use sans-serif fonts when displayed on a screen and serif fonts when printed.
‘screen’ and ‘print’ are two media types that have been defined. Media queries extend the functionality of
media types by allowing more precise labeling of style sheets.<p class="paragraph"/>A media query consists of a media type and zero or more expressions that check for the conditions of
particular media features. Among the media features that can be used in media queries are ‘width’, ‘height’,
and ‘color’. By using media queries, presentations can be tailored to a specific range of output devices
without changing the content itself.<p class="paragraph"/>In this project, in order to let user views web-pages friendlier in their mobile devices, I use media
query to test the ‘width’ of a web page so as to dynamically change its format accordingly.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/CSSMediaQuery.png"></img><p class="paragraph"/>As you can see from the illustration, when you view a web page in your mobile device, the ‘width’ of the page
will be smaller. The media query observes this change and automatically formats the table from horizontal
(left one) to vertical (right one).



<h2 id="Ajax">4.4 AJAX</h2>
Ajax is used in this project to create asynchronous web applications.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/Ajax.png"></img><p class="paragraph"/>As user chooses different ‘Library Unit’ when creating a RidTransacton instance, the items in
‘Mode of Consultation’, ‘Service Provided’ and ‘User Goal will change’. With Ajax, web applications
can send data of ‘Library Unit’ to, and retrieve data from the server asynchronously (in the background)
without interfering with the display and behavior of the existing page.
Here, data is retrieved using JSON, and jQuery is used to change the items in those three drop-down list boxes.



<h2 id="Excel">4.5 Excel Importing/Exporting Function</h2>
The importing here means that user can upload an excel file containing the information to create
instances of RidTransaction. When user uploads a spreadsheet (excel file), the server checks it,
parses it and then saves it in the database if all the information and format are validated, otherwise
throws errors to user. The exporting stands for user can download a spreadsheet contain particular
instances to the local.<p class="paragraph"/>I use HSSF/XSSF in <a href="http://poi.apache.org/spreadsheet/index.html" target="blank">Apache POI</a> to deal with excel
<a href="http://www.andykhan.com/jexcelapi/tutorial.html" target="blank">importing and exporting</a>.
Apache POI is a Java API for Microsoft Documents. HSSF is the POI Project's pure Java implementation of the
Excel '97(-2007) file format. XSSF is the POI Project's pure Java implementation of the Excel 2007 OOXML (.xlsx)
file format. HSSF and XSSF provide ways to read spreadsheets create, modify, read and write XLS spreadsheets.
They provide: low level structures for those with special needs, an event model API for efficient read-only access,
and a full user model API for creating, reading and modifying XLS files.



<h2 id="Form">4.6 Duplicated Form Submissions Handling</h2>
Grails has built-in support for handling
<a href="http://grails.org/doc/2.2.1/ref/Controllers/withForm.html" target="blank">duplicated form submissions</a>
using the "Synchronizer Token Pattern".
After defining a token on the form tag, each submission will be combined with a unique token before being processed.
Grails checks the token of each submission. Duplicated tokens mean duplicated submissions.<p class="paragraph"/>This mechanism makes use of the session and hence requires session affinity or clustered sessions if used in a cluster.<p class="paragraph"/><p class="paragraph"/>



<h1 id="unitTests">5 Unit Tests</h1>
<a href="http://grails.org/doc/latest/guide/testing.html" target="blank">Unit tests</a> in Grails in much like unit tests in Junit.
Mock Object is used here. Also SynchronizerToken class is used to simulate duplicated submissions.<p class="paragraph"/><blockquote class="note">
Note that the unit test example for testing duplicated submissions given in the Official Grail Document does NOT work.
Here is the way I use instead to test duplicated submissions:
<div class="code"><pre><span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.servlet.mvc.SynchronizerTokensHolder<p class="paragraph"/>    void testValidSave() &#123;
        def URL = <span class="java&#45;quote">"foo.com"</span>
        def token = SynchronizerTokensHolder.store(session)
        controller.params&#91;SynchronizerTokensHolder.TOKEN_KEY&#93; = token.generateToken(URL)
        controller.params&#91;SynchronizerTokensHolder.TOKEN_URI&#93; = URL<p class="paragraph"/>        ...<p class="paragraph"/>        form.firstSubmitted() // pass<p class="paragraph"/>        ...<p class="paragraph"/>        form.duplicatedSubmitted() // fail
    &#125;</pre></div>
</blockquote>


<h1 id="conclusion">6 Insight and Conclusion</h1>
As the first large web application project completed by myself so far, this is a challenging while enjoying process.
The most challenging part is learning all those fantastic web stuff, implementing each individual module, and in
the end integrating all the modules into one large system. Each part needs the help from other modules.
I learn lots of web technology from this project and know that a website can work well only after you put
everything -- database, server, html, css, javascript, etc. – together. Through this project, I develop a profound
understanding of MVC framework, know the difficulty to handle browser compatibility, and most importantly,
get an insight about how to build a fantastically organized website.<p class="paragraph"/>The project is not that technical as the project of a hard class, but it provides an excellent opportunity
for me to get hands-on experience of designing a web application from the very beginning. Another reason makes
it different with the project in class is this is a really application-oriented project. I must try to consider
from the users’ perspective. Some questions are opening and contingent. Lots of discussion and brainstorming are
needed. I get some real world experience which classes generally don't provide. As an independent study course,
I learn more from it than just coding.<p class="paragraph"/>Overall, I appreciate this experience considering the amount of knowledge and practical skills I learned from it,
and I am very much obliged to Joe Zucca (my advisor, zucca@pobox.upenn.edu) and
Thomas Barker(my manager, tbarker@pobox.upenn.edu) for all of their kind help.<p class="paragraph"/>


<h1 id="appendix">7 Appendix -- Relationship among domain classes</h1>
Here is an illustration of relationship among domain classes.<p class="paragraph"/><img border="0" class="center" src="../img/../../../src/docs/img/relationship.png"></img>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">commandline</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/commandline/configure-for-job-only.html">configure-for-job-only</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/commandline/flush-cache.html">flush-cache</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
